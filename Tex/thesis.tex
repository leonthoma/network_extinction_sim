\documentclass[12pt,a4paper]{article}
\usepackage[utf8]{inputenc}
\usepackage{csquotes}
\usepackage[english]{babel}
\usepackage[T1]{fontenc}
\usepackage{graphicx}
\usepackage{float}
\author{Leon Thoma}
\title{Master thesis in environmental sciences}
\usepackage[backend=biber, style=authoryear, sorting=none, giveninits=true]{biblatex}%  !!!In bib only state the first char of the first name!!!
\AtBeginBibliography{\footnotesize}
\usepackage{url}
\usepackage[font={footnotesize}, labelfont=bf]{caption}
\usepackage[table,xcdraw]{xcolor}
\usepackage{caption}
\usepackage{amssymb}
\usepackage{amsmath}
\addbibresource{extc_net.bib}
\defbibheading{none}{}
\usepackage[colorlinks]{hyperref}
\hypersetup{
    colorlinks,
    linkcolor={black!50!black},
    citecolor={black!50!black},
    urlcolor={blue!80!black}
}
\usepackage{multicol}
\begin{document}
\begin{titlepage}
	\centering
	\includegraphics[width=0.25\textwidth]{logo-grundversion-01}\par\vspace{1cm}
	{\scshape\large Albert-Ludwigs-Universität Freiburg\par}
	\vspace{1.25cm}
	{\scshape\large Thesis for the attainment of the degree:\\ Master of science\par}
	\vspace{.75cm}
	{\scshape\large Faculty for Environment and Natural Resources\par}
	\vspace{.75cm}
	{\scshape\large Chair of Biometry and Ecosystem Analysis\par}
	\vspace{.75cm}
	{\Large\itshape Rewiring networks under species loss: a simulation
study
\par}
	\vspace{.75cm}
	{\Large\itshape Leon Thoma\par}
	\vspace{.25cm}
	{\scshape\normalsize E-mail: leonthoma@gmx.de\par}
	\vspace{.15cm}
	{\scshape\normalsize Matriculation number: 3733253\par}
	\vspace{.75cm}
	\large Examiner:\par
	\large Prof. Dr. Carsten  \textsc{Dormann} \par
	\vspace{.5cm}
	\large Co-Examiner:\par
	\large Dr. Anne-Christine \textsc{Mupepele}
	\vfill

	{\large \today\par}
\end{titlepage}
	\tableofcontents
	\newpage	
	\section{Abstract} 

\newpage%
%
% RECHECKING:
% GO THROUGH ALL CITATIONS IN JABREF FOR CORRECT SPECIAL CHARACTERS AND GENERAL CHECK
%
\section{Introduction}
Contrary to a main question in the field of invasion ecology, how novel species influence interactions among species, stands the question of how species leaving an ecosystem affects the remaining species. 

% species leaving network can have influence on connection between sp over different biomes/ ecosystems (terrestrial/aquatic; knight 2005 in colwell 2012)
% coextinction is difficult to document (colwell 2012):
	% determining host specifity -> interaction partners might become extinct before their hosts (Moir 2010, 2012b, Powell 2011)
	% if spcies are reintroduced to wild, interactions partners might be affected by treatment used to bring up reintroduced species (e.g. biocides)
	% 

%
%The introduction of species was studied in a wide variety of ecosystems (references here) and across many species (references here), studying the effects of extinctions, however is much harder. This is due to the fact that  
% Intro to topic:
	% network ecology
		% lau2017
		% poisot2016; 10.1111/1365-2435.12799
		% vazquez2022
Network ecology has helped researchers to develop a more detailed understanding of ecological communities. Starting from analysing structures within networks and identifying patterns (e.g. modularity, nestedness, connectance ?) \parencite{Jordano1987, Dunne2002 } % Olesen2007, Bascompte2003 
to finding the underlying processes that lead to the observed patterns \parencite{Rezende2007, Vazquez2009, Thebault2010}. Especially the role of individual species and their interactions within communities was elucidated \parencite{Waser1996, Lau2017}.
Ecological communities are subject to constant change, due to a variety of reasons such as habitat fragmentation, global warming, introduction of species or loss thereof, to name some \parencite{}. In the face of the current rate of extinctions (e.g. see \cite{IPBES}), it is crucial to develop a deeper understanding of the changes an extinction event induces in ecological communities, in order to preserve it's function and prevent extinction cascades. 

	% extinction simulation
	

% Not really interested in influence of choice method or removal sequence on robustness. rather, how do a, t, l influence networks, e.g. structures (h2', connectance, etc.), interactions or robustness. also if a ,t or l were used to determine rewiring partner what were the results ? 

% here a qualitative approach of the influence of abundance, trait matching and phylogeny on the formation of interactions. using extinction simulation with same metrics to check how robustness is affected by different rewiring methods.


	% Different approaches (Memmot, Kaiser-Bunbury, Vieira, Baumgartner, Vizentin-Bugoni)
The following 3 models mark cornerstones in advances of extinction cascade modelling. In 2004 \citeauthor{Memmott2004} simulated secondary extinction for plant-pollinator networks using three scenarios for initial extinctions of pollinators (but not plants). Random extinction (Null model), sequential removal of species starting with the most linked, and sequential removal starting with the least linked species. A species was considered to be coextinct if it lost all its interactions. However, the approach disregarded a few key points, such as the quality of a given interaction (i.e. pollination success and frequency of visits), the fact that plants can reproduce even without pollinators e.g. by selfing and arguably most important that species don't compensate for lost interaction partners (either by creating new interactions or enhancing existing ones). Nevertheless, the research of \citeauthor{Dunne2002} and \citeauthor{Memmott2004} provided helpful insights into network structure showing that species in less connected networks are more prone to suffer from coextinction. \par

A first quantitative approach to extinction modelling in mutualistic networks considering behavioural shifts (i.e. interaction rewiring) was done by \citeauthor{Kaiser-Bunbury2010} in 2010 \parencite{Kaiser-Bunbury2010}. They based rewiring on interactions between species that were observed at one point of time when the site was sampled. For example, if a species lost all it's interaction partners it would remain in the model with it's full interaction strength if a partner was present with which they observed an interaction in the network at an earlier or later point in time. Their results indicated that networks are more robust to extinction when rewiring is considered since it's 'artificially' increasing connectance. \par

In 2019 \citeauthor{Vizentin-Bugoni2019} extended the approach of \citeauthor{Memmott2004} and \citeauthor{Dunne2002} \parencite{Memmott2004, Dunne2002} for (co)extinction simulation.
% by enhancing the functions provided in the bipartite R-package \parencite{dormann2008}. 

%% Rephrase !!!
Rewiring was implemented as a two step process. First a potential partner is chosen based either on (1) variables known to be important for species interactions in the studied network (e.g. abundance) or (2) at random. Second, the model computes a rewiring probability for the chosen partner, accounting for species abundance, phenological overlap, morphological traits and combinations thereof. Finally, a binomial trail will determine if rewiring is successful or not. Furthermore, the model allows its users to choose the number of rewiring attempts \footnote{
One try with a single partner, 
multiple tries with a single partner, 
one try with each partner, 
multiple tries with multiple partners
}. Following the assumption of \citeauthor{Memmott2004} and \citeauthor{Dunne2002}, a species was considered coextinct if it lost all it's interaction partners.
\par

Phylogeny has been identified to play a key role in the formation of interactions in bipartite networks \parencite{Rezende2007}. The authors showed that phylogenetic relatedness was predicting the identity of species' interaction partners in 46.6 \% of networks. They also found, that the number of interactions of phylogenetically related species was similar in 39 \% of networks.
	% general results of extc sim w/ rewiring
		% robustness increases w/ rewiring: dunne2002, eklöf2006, thebault & fontaine2010, baumgartner2020
The results of research on extinctions and their propagation in ecological networks have shown, that loss of generalists causes a higher rate of coextinction than loss of specialists (\cite{Memmott2004, Kaiser-Bunbury2010, Traveset2017, Bastazini2018, Vizentin-Bugoni2019, Biella2020}; but see \cite{Dunne2002}). 
-> WHY

Another result was a substantially higher robustness in mutualistic bipartite networks, when species were removed from the higher trophic level compared to when lower trophic level species were removed \parencite{Schleuning2016}.

%This was the case irrespective of how the species that was to be removed was chosen, i.e. random, abundance based, etc.(RECHECK!!!) 
%This is most likely due to the fact, that species' roles in networks are highly asymmetric, meaning species belonging to the higher trophic level are very dependent on their interaction partners from the lower level, but not vice versa \parencite{Bascompte2006}.

\citeauthor{Dunne2002, Ekloef2006} and, \citeauthor{Thebault2010} found a positive correlation of network robustness and connectance \parencite{Dunne2002, Ekloef2006, Thebault2010}. However, \citeauthor{Vieira2015} showed that the opposite was the case \parencite{Vieira2015}. They argued, that the assumption, that coextinction only occurs when a species loses all its interaction partners, which the previous studies made, led to their finding. Recently, \citeauthor{Baumgartner2020}, challenged the reasoning of \citeauthor{Vieira2015} by showing a positive correlation between network robustness and connectance using an extinction algorithm that accounts for the interaction strengths (i.e. dependence), intrinsic demographic dependence, and dissimilarity of species to estimate coextinction susceptibility \parencite{Baumgartner2020}. 
% by including coext threshold this can be tested here !!! 


\parencite{Kaiser-Bunbury2010, Schleuning2016, Timoteo2016, Costa2018} higher robustness due to rewiring. % also (Ramos‐Jiliberto et al.,
%2012; Nuwagaba et al., 2017) from baumgartner2020; compare with blüthgen2010 and vieira2015


% Explaining problem/ gap of knowledge
Despite the insights previous studies provided, it is still unclear if rewiring is influenced by how species interact (ie. what drives the interactions), which then affects the number of secondary extinctions in a network. To provide further insight into the mechanistics behind rewiring, this study will focus on modelling extinction cascades using simulated networks with controlled . \\

% For example, using the same rewiring criteria, does robustness change when the main driver of interactions in the network is changed ? Its still unknown if e.g. the abundance of species in a network changes the propagation of extinctions. 
	% rewiring methods
	not clear how different rewiring mechanisms affect extinction propagation. especially in bugoni et al combining rewiring mechanisms led to lower effect size than single rewiring mechanisms

% Explain the approach
The analysis of this study was a two step process. First, networks were simulated and then used in the extinction algorithm to assess network robustnesses (see fig. \ref{fig:extc_alg}).  
Network simulations were based on the approach presented by \citeauthor{Benadi} \parencite{Benadi}. The 'observed' interactions in a network are simulated by combining abundance, trait, and phylogenetic information. The influence of the three variables on the formation of interactions between species was altered by using either one, none or all of them as the main driver.
To identify differences in the network structures among the network simulation scenarios, the two dimensional shannon entropy (H2') was calculated as a measure for specialization \parencite{Blüthgen2006}.
	% rewiring methods
	finding out how different rewiring methods influence extinction cascades in networks. therefore select one com var to be main driver of interactions in network and compare the rew methods. 
	
	simulating networks has the advantage of equal "sampling effort" and is therefore not affected by sampling biases !!
% Research questions
Does network robustness change for different rewiring methods when the driving force of interactions in networks is altered ?

Is network robustness affected by underlying interrelations between the drivers of species interaction and their way of choosing rewiring partners 
% higher connectance leads to higher robustness (following dunne2002, eklöf2006, thebault & fontaine 2010, baumgartner2020

%first question: what influence does com_vars have on robustness (compare all com_vars using norew)
%	-> 
%second question: what influence does rew have on robustness (compare all rew using org networks) -> focus of thesis should be rew methods !
%	-> rew should be most efficient for specialised networks
%	
%resulting third question: is there an interrelationship of com_vars and rew that influences robustness (use no of singletons per network comparing rew methods)
%	-> comparing H2' would expect highest effect of rewiring for specialised networks, but maybe only highly abundant/trait matching/phylogeny matching species are specialised and the rest isn't. therefore check no of singeltons in networks (ie sp most endangered by coextinction) and compare the robustness 

%However, since phylogenetically closely related species often show similar traits, the set of species they interact with also tends to overlap \parencite{Gomez2010, Rezende2007}. The difference in robustness for trait and phylogeny based networks should thus be small when using trait or phylogeny based rewiring. 
\newpage

	\section{Material \& Methods}
	The simulations in this study were executed in R \parencite{Rcore} (version 3.6.3) based on the functions of the tapnet\footnote{The paper is yet to be published, but the package and it's vignette are available via CRAN and GitHub; https://cran.r-project.org/web/packages/tapnet/index.html, https://github.com/biometry/tapnet} \parencite{Benadi} and bipartite \parencite{Dormann2008} packages as well as the approach of the extinction algorithm developed by \citeauthor{Vizentin-Bugoni2019} \parencite{Vizentin-Bugoni2019}. Some of the functions provided by these sources were modified or augmented to match the specific needs of the presented approach. The source code of this analysis is available in the supplementary materials. \par


% describe general approach:
	% initial network sim
	% sim webs w/ com_var
	% choose rewiring method & extinction method
	% run extc models

	\subsection{Network simulation} \label{sec:net_sim}
	To simulate the networks, each of the three community variables (abundance (a), traits (t), and phylogeny/latent traits (l)) were provided as an independent two-dimensional matrix defined by the species of the two trophic levels. First, interaction frequencies were derived from the linear combination of the three community variable matrices, which are all scaled to sum of one before and after their multiplication. Interaction frequencies were then used as probabilities in a multinomial draw to calculate the desired number of 'observed' interactions (see also fig. 1 in \cite{Benadi} for a conceptual overview). \par

	
	% first simulate initial network with set no of sp in lower and upper trophic level, no of traits w/ and w/o pems -> done with simulate_tapnet_aug
	The number of species in the trophic levels of the initial network was 40 and 50 for the lower and higher level, respectively. Total number of observations was set to 1111. The number of simulated traits was set to 2 for phylogenetically correlated and uncorrelated traits each.
	% caradonna: nobs: 30000, ntraits: 2, nlow: , nhigh:
	% kaiser-bunbury: nobs: 1278, ntraits: NA, nlow: , nhigh:
	% costa: nobs: 	3974, ntraits: NA, nlow: , nhigh:
	% bugoni: nobs: na, ntraits; 2, nsims:1000, nlow: , nhigh
	% schleuning:   see supp mat.
	% memmot (10.1046/j.1461-0248.1999.00087.x): nobs: 2183, nlow: , nhigh: 
	% vazquez/simberloff (10.1046/j.1461-0248.2003.00534.x): nobs: 5285, nlow: , nhigh:
	

	% using simulated abundances, traits and other params (paramlist) simulate omat for all com importance scenarios
	Using the abundance \& trait matrices and the phylogenetic eigenmatrices from the initial simulation, five networks were simulated with 1000 simulations each. Additionally, either one, all or none of the three community variables used to simulate interactions were selected as a main driver. This was achieved by exponentiating the corresponding matrix with either 0.1 or 1.9, resulting in high or low importance respectively. If none of the variables were regarded as especially important, matrices were left unchanged (i.e. the exponent was 1). The networks will be referred to as Atl, aTl, atL, atl, and ATL with capital letter(s) indicating high importance and lower letters indicating low importance of the respective community variable. Furthermore, simulations where the community variable importances were not altered (i.e. exponentiating the matrices with 1) are called original.
	
	 The simulation of networks produced pairings where no interaction between species occurred (from now on called 'improbable interactions'). This is due to interaction probabilities being so small that an interaction is not 'observed' every time the network is simulated. Therefore, species pairs with improbable interactions were removed before using the networks for extinction simulation. However, since marginal totals were used to identify and delete species pairs with improbable interactions, there were cases where after removing the species, new improbable interactions were introduced. For example, if a species had only one interaction with another species that was deleted, the first species was then left without interactions.
	 
%	 , which is an inherent problem resulting from the approach chosen by the authors. 
	 
The distribution of improbable interactions for all simulations can be seen in figs. \ref{fig:int_lower} \& \ref{fig:int_higher}. 

% Improbable interactions
% lower
\begin{figure}[H]
	 \includegraphics[width = \textwidth]{/home/leon/Documents/Uni/M.sc/Master Thesis/Networks/models/plot_sink/dead_pre_lower}
	 \caption{\textbf{Improbable interactions for lower level species} The boxplots show the number of improbable interactions for each community variable importance scenario. See section \ref{sec:net_sim} for a definition of improbable interactions and a detailed explanation of the abbreviations of community variable importances.}
	 \label{fig:int_lower}
\end{figure}

% higher
\begin{figure}[H]
	 \includegraphics[width = \textwidth]{/home/leon/Documents/Uni/M.sc/Master Thesis/Networks/models/plot_sink/dead_pre_higher}
	 \caption{\textbf{Improbable interactions for higher level species} The boxplots show the number of improbable interactions for each community variable importance scenario. See section \ref{sec:net_sim} for a definition of improbable interactions and a detailed explanation of the abbreviations of community variable importances.}
	 \label{fig:int_higher}
\end{figure}

% by simulating networks problematic sampling effects are avoided (blüthgen2010, vazquez2022)


	% partner choice for rewiring based on values from init sim; using cophenetic.phylo fy for phylogenetic distance
	Partner choice in the rewiring process of the extinction simulations was based on the abundances, traits and phylogeny of the initial simulation. For phylogeny, the phylogenetic distances of the higher and lower trophic level were computed.
	\subsection{Extinction simulation} \label{sec:extc_sim}
	After networks were simulated, a modified version (see supplementary materials 'extc.alg') of \citeauthor{Vizentin-Bugoni2019}'s algorithm was used to simulate extinction. The algorithm used here is structured as follows (see fig. \ref{fig:extc_alg} for a visual overview). To easily distinguish the different scenarios, the following naming convention was established. The trophic level from which species are removed during the extinction simulation as well as the rewiring method are noted in superscript, respecitvely. For example Atl\textsubscript{lower, abund}, refers to a simulation where Abundance was the main driver of species interactions during the network simulation (see section \ref{sec:net_sim} for network abbreviations), species were removed from the lower trophic level during extinction simulation with abundance based rewiring.

% put this in a box ?!	
	\begin{figure}[H]
	 \includegraphics[width = \textwidth]{/home/leon/Documents/Uni/M.sc/Master Thesis/Networks/approach_overview}
	 \caption{\textbf{Schematic overview of network \& extinction simulations} The left hand side shows the process of network simulation. From the initial network four netowrks were simulated according to the approach described in section \ref{sec:net_sim}. The right hand side shows the simplified structure of the extinction algorithm. The primary extinction (2.1) in each iteration is determined based on the user specified methods comprising trophic level (2.1.1) and species selection (2.1.2) (see section \ref{subsec:extc_alg} step \ref{itm:etxc} for details). Network A shows the species that is removed in black and the lost interactions with its partners in red. The algorithm then checks if other species are coextinct (2.2) by comparing the coextinction threshold to the amount of remaining interactions of each species (see section \ref{subsec:extc_alg} step \ref{itm:track} for details). Network B depicts the species lost due to coextinction in black with its interactions in orange. The next step is to determine interaction rewiring (2.3). Using one of the three rewiring methods (2.3.1, 2.3.2 or 2.3.3), species try to rewire to new partners or strengthen interactions with their other partners (see section \ref{subsec:extc_alg} step \ref{itm:rew} for details). Network C shows possible rewiring for one species (shown in black) based on abundance (red), traits (blue) or phylogeny (beige).
	 The last step of each iteration is redrawing the network from a multinomial distribution with the updated interaction probabilities (see section \ref{sec:net_sim} for details). The algorithm stops redrawing networks once only two species in the trophic level chosen for primary extinction are left. The remaining species are determined by running steps 2.1 - 2.3.}
	 \label{fig:extc_alg}
\end{figure}
	
\subsubsection{Extinction algorithm} \label{subsec:extc_alg}
\begin{enumerate} 
	\item \textbf{Delete improbable interactions} {\small Check if improbable interactions were introduced in the simulation process and delete them prior to extinction simulation.}
	\item \textbf{Set the adaptability of species} {\small This represents a probability which is used to express a species inclination to change interactions partners. The values range from 0 to 1 and are either set to 0.5 if this feature should not be used or originate from a uniform distribution.}
	\item \label{itm:etxc} \textbf{Extinction} {\small Delete a species from the network based on the provided methods (lower, higher trophic level(s) and random selection).}
%This is executed using the extinction.mod function from \citeauthor{vizentin-bugoni2019} which is based on the extinction function from the bipartite package.}
	\item \label{itm:failsafe} \textbf{Handling improbable interactions} {\small Since the algorithm redraws from a multinomial distribution using the updated interaction matrix to generate the network (see \ref{itm:redraw} for details), improbable interactions can be introduced. This step is implemented to make sure the extinct species has valid interactions. If the extinct species has no interactions, the previous step is repeated until a species with valid interactions was found or three tries are reached. If this process is unsuccessful, the algorithm 'skips' the current extinction step by skipping steps (\ref{itm:rew}, \ref{itm:shift}, \ref{itm:track}, and \ref{itm:update}) and redraws a new network (i.e. continuing at step \ref{itm:redraw}). The simulation is stopped if there are three instances where steps were skipped because of improbable interactions.}
	\item \label{itm:rew} \textbf{Rewiring} {\small All species that had at least one observed interaction with the extinct species, will try rewiring. The choice of the rewiring partner, i.e. the species that the afore mentioned species will try to rewire to, can be set by the user and comprises the following three options (all using the values from the initial simulation)}
		\begin{itemize}
		\item \label{itm:abund_rew} \textbf{Abundance} {\small The species with the highest abundance is selected.}
		\item \label{itm:trait_rew} \textbf{Traits} {\small Euclidean distances of all traits are calculated. The species with the smallest trait distance across all traits compared to the extinct species is selected.}
		\item \label{itm:phylo_rew} \textbf{Phylogeny} {\small The species with the lowest phylogenetic distance to the extinct species is chosen. If multiple species have the same distance, one is selected at random.}
		\item \label{itm:AT_rew} \textbf{Abundance x Trait} {\small The rewiring probabilities were calculated according to the respective method and their sum was used}
		\item \label{itm:AP_rew} \textbf{Abundance x Phylogeny} {\small The rewiring probabilities were calculated according to the respective method and their sum was used}
		\end{itemize}
	\item \label{itm:shift} \textbf{Preference shift} {\small Interaction probabilities are updated, simulating the process of species changing their foraging preferences due to losing one of their interaction partners. New interaction probabilities are the sum of (1) the values of the interaction between the extinct species and the rewiring partner and (2) the values of the interaction between the extinct species and the species that try to rewire. The latter is multiplied with the adaptability value of each species to account for the differences in how well or how willingly they rewire. If no adaptability values are provided, the algorithm defaults to 0.5.}
	\item  \label{itm:track} \textbf{Tracking (co)extinctions} {\small Users can specify a threshold which determines coextinction of species based on the percentage of remaining interactions. If the quotient of total interactions after and before an extinction step is below or equal to the threshold, a species will be considered coextinct. Since the number of interactions are resimulated in each iteration, the divisor is the number of interactions of the last iteration and not the number of interactions of the initial web. Finally, the number of extinct and remaining species are noted for the higher and the lower trophic level.}
	\item \label{itm:update} \textbf{Update matrices} {\small The extinct species are deleted from the network and from the interaction matrix.}
	\item \label{itm:redraw} \textbf{Redraw network} {\small The updated interaction matrix is used to simulate observations by drawing from a multinomial distribution. This is the same step used in the data simulation (see \ref{sec:net_sim} for details) and can lead to the introduction of improbable interactions to the network. Therefore dead interactions are registered and these species will remain in the network if they were 'inherited' from a previous redraw, i.e. extinction iteration.}
	\end{enumerate}
	% running extinction functions. using modified version of bugoni's extinction fy
		% algorithm structure:
			% delete dead interactions from webs
			% set adaptability (prob) of sp; either draw from unif dist or .5 for all
			% delete sp from web using extinction.mod from bugoni (based on bipartite)
			% dead interaction handling; retry max three times to find sp that has also valid interactions, if unsuccessful skip iteration
			% choice of rewiring partner (i.e. sp that shall replace extc sp; always compared to extc sp):
				% abund: use abundances from init sim to select sp with highest abund
				% trait: calculate euclidean distances of all traits from init sim; select sp with smallest trait distance over all distances
				% phylo: use sp. with lowest phylogenetic distance; if more than 1 sp have same distance randomly choose one
			% shift interaction probs; sum of interaction probs of rew partner and extc sp and interaction probs of extc sp and sp that try rewiring (i.e. old 					  interactions partners of extc sp) times the adaptability of each sp
			% df with number of extc sp & remaining sp per level is updated
			% update imat; retain dead interactions that were introduced by imat in previous step
			% calculate new web from updated interactions; check if dead interactions were introduced
			
		% following extinctions were run (always for lower and higher level extc, except for 'both'; also w/ and w/o rewiring):
			% org = default com importance; random extinction of sp
			% abund = abundance led extinction of sp
			% both = random extc from lower or higher level, random extc of sp
			% random = random extc of sp
 Four distinct extinction scenarios were simulated. (1) Default importances of the community variables and choosing a random species for extinction, (2) Abundance, Trait or Phylogeny based networks with random choice of the extinct species, (3) Abundance, Trait or Phylogeny based networks with abundance based choice of the extinct species, (4) Abundance, Trait or Phylogeny based networks with random extinction on one of either trophic level and random choice of the extinct species.
 Furthermore each of the four simulation scenarios were run with the coextinction threshold set to 0, 25, 50, or 75 \%. 
 
%\begin{table}[H]
%\centering
%\caption{\textbf{Overview of extinction models} If community variables were set to low or high contribution to determine species interactions (see \ref{sec:net_sim} for details) one model with each setting was simulated. For trophic levels either the higher or lower level was chosen and extinctions were simulated. In the 'Trophic' model either the lower or higher trophic level was chosen randomly each extinction step and a species was removed. Except for the 'Abundance' model, the species that was removed was chosen at random. For the 'Abundance' model the species with the lowest abundance was removed sequentially. Each model was run with and without rewiring.}
%\label{tab:models}
%\resizebox{\textwidth}{!}{%
%\begin{tabular}{llll}
%Model & Community variables & Trophic levels & Species removed \\ \hline
%Null & None & lower; higher & Random \\
%Base & Abundance; Traits; Phylogeny & lower; higher & Random \\
%Trophic & Abundance; Traits; Phylogeny & lower \& higher & Random \\
%Abundance & Abundance; Traits; Phylogeny & lower; higher & Abundance based
%\end{tabular}%
%}
%\end{table}

Since the extinction simulations produced sequences of different lengths (e.g. due to variable numbers of species in each trophic level as a result of improbable interactions, network simulation scenario or extinction simulation itself), shorter extinction sequences were extended using zeros. This had no effect on the subsequent analyses and was only necessary to create dataframes in R.
Following the extinction simulations, the robustness of each network was calculated. To assess the effects of rewiring and network simulation on robustness a ANOVA was used with the number of species from the lower and the upper trophic level, community variable importance, rewiring method, H2', the interaction between rewiring method and H2', as well as the extinction scenario as predictors.

 
%	% computing means of all simulations for each scenario
%	The individual runs of each extinction scenario led to different lengths of the extinction sequences, therefore the longest sequence of each of the 10 simulations per web was chosen and the simulations with shorter sequences were filled with zeros to match their lengths. Then the mean per web was calculated.
%	% calculating percentages of remaining sp
%	With the mean number of extinct and remaining species per step of the extinction sequence, the percentage of remaining species was calculated.
%	% computing means of all webs
%	Finally, the mean over all webs was calculated. Since the extinction scenarios also produced different lengths, the longest extinction sequence per scenario was used as the target length and shorter sequences were padded with zeros to match the target length.
\section{Results}
There were a number of extinction simulations that were exited prematurely because of improbable interactions. In these cases the algorithm failed to find alternatives to species with improbable interactions three times. Simulations using abundance based rewiring, showed the highest percentage of aborted runs. Furthermore, especially aTl, atL, and atl networks resulted in frequent termination. Removing species from the lower level generally resulted in lower aborted simulations than removing species from the higher level. See tables \ref{tab:abort_lower_perc} and \ref{tab:abort_higher_perc} for an overview over all combinations of simulations that were run.
% Simulation aborts on lower level
%\begin{table}[H]
%\centering
%\caption{Number of aborted extinction simulations with initial extinction on the lower trophic level. The total number of simulation for each combination of community variable importance and rewiring method was 10000}
%\label{tab:abort_lower}
%\resizebox{\textwidth}{!}{%
%\begin{tabular}{lllllll}
% & org & Atl & aTl & atL & atl & ATL  \\ \hline
%No rewiring & 173  & 139 & 540 & 781 & 999 & 0 \\
%Abundance & 331 & 134 & 1252 & 1391 & 1561 & 0  \\
%Trait & 260 & 185 & 256 & 645 & 770 & 0  \\
%Phylogeny & 12 & 14 & 209 & 281 & 341 & 0  \\
%\begin{tabular}[c]{@{}l@{}}Abundance x \\ Trait\end{tabular} & 295 & 18 & 502 & 497 & 534 & 0  \\
%\begin{tabular}[c]{@{}l@{}}Abundance x \\ Phylogeny\end{tabular} & 69 & 151 & 537 & 775 & 850 & 0 
%\end{tabular}
%}
%\end{table}

% in percent
\begin{table}[H]
\centering
\caption{Percentage of aborted extinction simulations with initial extinction on the lower trophic level. The total number of simulation for each combination of community variable importance and rewiring method was 10000}
\label{tab:abort_lower_perc}
\resizebox{\textwidth}{!}{%
\begin{tabular}{lllllll}
 & org & Atl & aTl & atL & atl & ATL  \\ \hline
No rewiring & 1.73 & 1.39 & 5.40 & 7.81 & 9.99 & 0  \\
Abundance & 3.31 & 1.34 & 12.51 & 13.91 & 15.61 & 0  \\
Trait & 2.60 & 1.85 & 2.56 & 6.45 & 7.70 & 0  \\
Phylogeny & 0.12 & 0.14 & 2.09 & 2.81 & 3.41 & 0  \\
\begin{tabular}[c]{@{}l@{}}Abundance x \\ Trait\end{tabular} & 2.95 & 0.18 & 5.02 & 4.97 & 5.34 & 0  \\
\begin{tabular}[c]{@{}l@{}}Abundance x \\ Phylogeny\end{tabular} & 0.69 & 1.51 & 5.37 & 7.75 & 8.50 & 0 
\end{tabular}%
}
\end{table}

% Simulation aborts on higher level
%\begin{table}[]
%\centering
%\caption{Number of aborted extinction simulations with initial extinction on the higher trophic level. The total number of simulation for each combination of community variable importance and rewiring method was 10000}
%\label{tab:abort_higher}
%\resizebox{\textwidth}{!}{%
%\begin{tabular}{lllllll}
% & org & Atl & aTl & atL & atl & ATL \\ \hline
%No rewiring & 245 & 189 & 752 & 1098 & 1367 & 2 \\
%Abundance & 475 & 174 & 1556 & 1864 & 2008 & 1 \\
%Trait & 315 & 253 & 339 & 886 & 1017 & 2 \\
%Phylogeny & 22 & 19 & 268 & 328 & 413 & 1 \\
%\begin{tabular}[c]{@{}l@{}}Abundance x \\ Trait\end{tabular} & 445 & 226 & 666 & 1112 & 1130 & 3 \\
%\begin{tabular}[c]{@{}l@{}}Abundance x \\ Phylogeny\end{tabular} & 118 & 36 & 637 & 694 & 725 & 0
%\end{tabular}%
%}
%\end{table}

% in percent
\begin{table}[H]
\centering
\caption{Percentage of aborted extinction simulations with initial extinction on the higher trophic level. The total number of simulation for each combination of community variable importance and rewiring method was 10000}
\label{tab:abort_higher_perc}
\resizebox{\textwidth}{!}{%
\begin{tabular}{lllllll}
 & org & Atl & aTl & atL & atl & ATL  \\ \hline
No rewiring & 2.45 & 1.89 & 7.52 & 10.98 & 13.67 & 0.02  \\
Abundance & 4.75 & 1.74 & 15.56 & 18.64 & 20.08 & 0.01  \\
Trait & 3.15 & 2.53 & 3.39 & 8.86 & 10.17 & 0.02  \\
Phylogeny & 0.22 & 0.19 & 2.68 & 3.28 & 4.13 & 0.01  \\
\begin{tabular}[c]{@{}l@{}}Abundance x \\ Trait\end{tabular} & 4.45 & 2.26 & 6.66 & 11.12 & 11.30 & 0.03  \\
\begin{tabular}[c]{@{}l@{}}Abundance x \\ Phylogeny\end{tabular} & 1.18 & 0.36 & 6.37 & 6.94 & 7.25 & 0 
\end{tabular}%
}
\end{table}

\subsection{Question1}
% Q1 comparing comvars


%The networks that were simulated with abundance as driving force for interactions showed the highest H2' mean values ($\overline{H2'}\textsubscript{Atl} = 0.348$). Phylogeny based networks showed the second highest mean H2' values($\overline{H2'}\textsubscript{atL} = 0.281$), followed by networks where no community variable was regarded of particular importance($\overline{H2'}\textsubscript{atl}$ = 0.229). Trait based networks showed second lowest mean H2' values ($\overline{H2'}\textsubscript{Atl} = 0.197$) and networks with all community variables set to be important had the lowest interaction specialisation ($\overline{H2'}\textsubscript{Atl} = 0.1$). Figure \ref{fig:h2} provides an overview of H2' values of the five networks.
Changing the driving force of species interactions during the network simulation, had an effect on the general specialisation of species in a network (see figure \ref{fig:h2}). The networks that were simulated using the standard tapnet approach showed relatively high niche overlap ($ \overline{H2'}_{original} = 0.23 $). The most conform network was ATL($ \overline{H2'}_{ATL} = 0.14 $). The only other network simulation where specialisation was lower compared to the original networks was aTl ($ \overline{H2'}_{aTl} = 0.21 $). In Atl, atL, and atl networks species' interactions were more unique which led to higher H2' values ($ \overline{H2'}_{Atl} = 0.35 $, $ \overline{H2'}_{atL} = 0.28 $, and $ \overline{H2'}_{atl} = 0.37 $, respectively).
\begin{figure}[h]
	 \includegraphics[width = \textwidth]{/home/leon/Documents/Uni/M.sc/Master Thesis/Networks/models/plot_sink/h2'_all}
	 \caption{\textbf{Two dimensional Shannon Entropy of all networks} The boxplots show the H2' values for each community variable importance scenario. See section \ref{sec:net_sim} for a detailed explanation of the abbreviations of community variable importances.}
	 \label{fig:h2}
\end{figure}

To analyse the effect of community variable importance on robustness, networks were compared using no rewiring in the extinction simulation. There was a clear trend of ATL networks being most resistant to extinction cascades, regardless from which trophic level species were removed (see plots \ref{fig:extc_cv_norew_lower} and \ref{fig:extc_cv_norew_higher}). All networks showed a relatively low rate of secondary extinctions until a certain percentage of primary extinctions was met, after which secondary extinctions substanitally increased. This effect was especially present in original, Atl, and ATL networks, when species were removed from the lower trophic level.  Between 99.7 \% (ATL) and 98.1 \% (Atl) of species from the higher trophic level remained after the loss of 75 \% of species from the lower trophic level. However, this trend was less pronounced in the other networks for both species removal scenarios. \par

% compare no of secondary extinctions between lower and higher for each extinction step

It should be noted though, that the extinction curves in plots \ref{fig:extc_cv_norew_lower} and \ref{fig:extc_cv_norew_higher} only represent one network. The boxplots in figure \ref{fig:auc_cv_norew} show the robustness values of all networks and their individual extinction simulation runs.
\begin{figure}[H]
	 \includegraphics[width = \textwidth]{/home/leon/Documents/Uni/M.sc/Master Thesis/Networks/models/plot_sink/extc_sims_cv_norew_lower}
	 \caption{\textbf{Extinction cascades of a single network} The plots shows extinction curves that were simulated for one of the generated networks. Species were removed randomly from the lower level and no rewiring was allowed. Individual extinction simulations are represented by the black lines, while the red line shows their mean. Plot titles indicate the importances of community variables used in the network simulation process. See section \ref{sec:net_sim} for a detailed explanation of the abbreviations of community variable importances.}
	 \label{fig:extc_cv_norew_lower}
\end{figure}


\begin{figure}[H]
	 \includegraphics[width = \textwidth]{/home/leon/Documents/Uni/M.sc/Master Thesis/Networks/models/plot_sink/extc_sims_cv_norew_higher}
	 \caption{\textbf{Variation of extinction cascades of a single network} The plots shows extinction curves that were simulated for one of the generated networks. Species were removed randomly from the higher level and no rewiring was allowed. Individual extinction simulations are represented by the black lines, while the red line shows their mean. Plot titles indicate the importances of community variables used in the network simulation process. See section \ref{sec:net_sim} for a detailed explanation of the abbreviations of community variable importances.}
	 \label{fig:extc_cv_norew_higher}
\end{figure}

There was a clear effect of the importance of community variables during the network simulation regarding robustness. The highest robustness was observed in networks were all community variables were considered important ($\overline{R}_{ATL, lower} = 93.19$ \& $\overline{R}_{ATL, higher} = 94.25$). Networks where the importance of all community variables was set to low, showed the lowest robustness ($\overline{R}_{atl, lower} = 77.45$ \& $\overline{R}_{atl, higher} = 78.67$). Generally, networks were less affected by primary extinctions when species were removed from the higher trophic level compared to species removal from the lower level ($\overline{R}_{lower} = 83.71 $ and $\overline{R}_{higher} = 85.06$). \par


\begin{figure}[H]
	 \includegraphics[width = \textwidth]{/home/leon/Documents/Uni/M.sc/Master Thesis/Networks/models/plot_sink/auc_com_vars_by_norew}
	 \caption{\textbf{Network robustness } The boxplots show the robustness values of all extinction simulations without rewiring and random removal of species. See section \ref{sec:net_sim} for a detailed explanation of the abbreviations of community variable importances.}
	 \label{fig:auc_cv_norew}
\end{figure}



\subsection{Question2}
% Q2 comparing rewiring

The second question focused on the differences between the rewiring methods. Therefore, only networks with the original importances of community variables were used. The majority of species from the trophic level where secondary extinctions were observed, remained in the network even after a severe loss of their interaction partners from the other trophic level. Combining rewiring methods, however, had only a small effect on network robustness.\\ Focusing on the loss of species in the final extinction step, there was little variance between the observed rewiring methods. There was, however, a substantial difference between the species removal scenarios. When animals were removed the final loss of species was considerably smaller than under plant removal. \par

% smallest last extc step lower: org_norew = 37.78, org_abund = 28.89, org_trait = 33.33, org_phylo = 24.44, org_AT = 35.55, org_AP = 40.0
% smallest last extc step higher: org_norew = 37.78, org_abund = 28.89, org_trait = 33.33, org_phylo = 24.44, org_AT = 35.55, org_AP = 40.0
\begin{figure}[H]
	 \includegraphics[width = \textwidth]{/home/leon/Documents/Uni/M.sc/Master Thesis/Networks/models/plot_sink/extc_sims_org_rew_lower}
	 \caption{\textbf{Extinction cascades of a single network} The plots shows extinction curves that were simulated for one of the generated networks. Species were removed randomly from the lower level using only original networks. Individual extinction simulations are represented by the black lines, while the red line shows their mean. Plot titles indicate the rewiring method used in the extinction simulation. See section \ref{itm:rew} for a details about the rewiring methods.}
	 \label{fig:extc_org_rew_lower}
\end{figure}


\begin{figure}[H]
	 \includegraphics[width = \textwidth]{/home/leon/Documents/Uni/M.sc/Master Thesis/Networks/models/plot_sink/extc_sims_org_rew_higher}
	 \caption{\textbf{Variation of extinction cascades of a single network} The plots shows extinction curves that were simulated for one of the generated networks. Species were removed randomly from the higher level using only original networks. Individual extinction simulations are represented by the black lines, while the red line shows their mean. Plot titles indicate the rewiring method used in the extinction simulation. See section \ref{subsec:extc_alg} step \ref{itm:rew} for details)}
	 \label{fig:extc_org_rew_higher}
\end{figure}

Network robustness seemed not to be influenced by the rewiring method to a large extend (see figure \ref{fig:auc_org_rew}. The difference in mean robustness between the most effective (phylogeny) and least effective rewiring method (abundance) was only 1.25 when removing plants and 1.23 when removing animals. Validating the result of the first question, robustness was higher when species from the higher trophic level were removed. Combining multiple rewiring mechanisms had an averaging effect on robustness. \\

Interestingly, simulations using abundance and abundance combined with trait rewiring, showed lower robustness than simulations without rewiring.
% seems to be connected to percentage of terminated simulation runs -> variance in robustness between extc runs quite high, so over all mean should also depict that.
\begin{figure}[H]
	 \includegraphics[width = \textwidth]{/home/leon/Documents/Uni/M.sc/Master Thesis/Networks/models/plot_sink/auc_org_by_rew}
	 \caption{\textbf{Network robustness } The boxplots show the robustness values of all extinction simulations fore each rewiring method and random removal of species. See section \ref{subsec:extc_alg} step \ref{itm:rew} for details) for a detailed explanation of the abbreviations of community variable importances. See section \ref{itm:rew} for a details about the rewiring methods.}
	 \label{fig:auc_org_rew}
\end{figure}

\newpage
	\section{Discussion}
% Shortly repeat the Question(s)

% Summarize the main findings

% sampling biases; vazquez2022, blüthgen2010
% Using connectance as a metric is unproblematic here since networks are simulated and therefore sampling effort is not influencing the number of detected interactions
% connectance & connectivity vary sig. between biogeographic regions (oelsen&jordano2002) but majority of sampled networks are coming from south america (e.g. brasil), apparently little data for temperate climate (i.e. europe or north america)
In addition to the mentioned sampling biases, there also seems to be a bias in sampling location. In the case of plant-pollinator networks, South America is clearly overrepresented. For example, half of the available data on plant-pollinator networks on the Interaction Web Database (\url{http://www.ecologia.ib.usp.br/iwdb/index.html}) come from Brazil, Argentina, Chile, Venezuela, and Ecuador. This might have influenced our common understanding of interactions networks since connectance and connectivity were shown to significantly vary between biogeographic regions \parencite{Oelsen2002}.


% see rezende2007 for phylogenetic rewiring !!

% construct validity !! can results be translated from simulations into reality ? does it make sense to assume these connections/interrelationships/results in real networks ?

% restrict formation of new interactions during rewiring process !

% only "quantitative" change in com_vars, could be interesting to change "qualitatively" i.e. abundance distribution (log-normal, normal, etc.), phylogeny (branching-early / branching late)...
\section{Conclusion}
\section{Acknowledgments}
\newpage
\section*{Declaration of Originality}
I, Leon Thoma hereby declare that the presented thesis is my own work and that I have not sought or used inadmissible help of third parties to produce this work. Furthermore, I have clearly referenced all sources used in the work and used inverted commas for all text directly or indirectly quoted from a source.\paragraph{}
This work has not been submitted to another examination institution - neither in Germany nor outside Germany - neither in the same nor in a similar way and has not been published.\paragraph{}

Freiburg,\paragraph{}

\rule{5cm}{.4pt}\par
Leon Thoma
\newpage
\begin{multicols}{2}[\printbibheading]
\printbibliography[heading=none]
\end{multicols}
\end{document}